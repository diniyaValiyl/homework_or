<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Корзина</title>
</head>
<body>
<h1>Корзина</h1>
<div id="cart"></div>

<script>
    function loadCart() {
        Promise.all([
            fetch('/dentalclinic/cart').then(r => r.json()),
            fetch('/dentalclinic/courses').then(r => r.json())
        ]).then(([cart, courses]) => {
            let html = '';
            let total = 0;

            for (let courseId in cart) {
                const course = courses.find(c => c.id == courseId);
                if (course) {
                    const quantity = cart[courseId];
                    const subtotal = course.price * quantity;
                    total += subtotal;

                    html += `<div style="border:1px solid #ccc; margin:10px; padding:10px;">
                        <h3>${course.name}</h3>
                        <p>Цена: ${course.price} руб. x ${quantity} = ${subtotal} руб.</p>
                        <button onclick="removeFromCart(${courseId})">Удалить</button>
                    </div>`;
                }
            }

            html += `<h3>Общая сумма: ${total} руб.</h3>`;
            document.getElementById('cart').innerHTML = html;
        });
    }

    function removeFromCart(courseId) {
        fetch('/dentalclinic/cart?action=remove&courseId=' + courseId, {method: 'POST'})
            .then(() => loadCart());
    }

    loadCart();
</script>
</body>
</html>